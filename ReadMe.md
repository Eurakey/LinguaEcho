# LINGUAECHO - äº§å“éœ€æ±‚æ–‡æ¡£ (PRD)

## 1. é¡¹ç›®æ¦‚è¿°

### 1.1 é¡¹ç›®ç›®æ ‡
å¼€å‘ä¸€ä¸ªAIé©±åŠ¨çš„è¯­è¨€å­¦ä¹ å¯¹è¯ç»ƒä¹ å¹³å°,å¸®åŠ©ç”¨æˆ·é€šè¿‡å®é™…å¯¹è¯åœºæ™¯ç»ƒä¹ ç›®æ ‡è¯­è¨€,å¹¶è·å¾—è¯¦ç»†çš„åé¦ˆæŠ¥å‘Šã€‚

### 1.2 æ ¸å¿ƒä»·å€¼
- **å®æˆ˜ç»ƒä¹ **: æä¾›çœŸå®åœºæ™¯å¯¹è¯ç»ƒä¹ 
- **æ™ºèƒ½åé¦ˆ**: AIåˆ†æè¯­è¨€ä½¿ç”¨é—®é¢˜å¹¶ç»™å‡ºå»ºè®®
- **é›¶é—¨æ§›**: æ— éœ€æ³¨å†Œ,æ‰“å¼€å³ç”¨

### 1.3 ç›®æ ‡ç”¨æˆ·
è¯­è¨€å­¦ä¹ è€…(åˆçº§åˆ°ä¸­çº§),å¸Œæœ›æå‡å£è¯­/ä¹¦é¢è¡¨è¾¾èƒ½åŠ›

---

## 2. åŠŸèƒ½éœ€æ±‚

### 2.1 Phase 1: MVPæ ¸å¿ƒåŠŸèƒ½ (å½“å‰é˜¶æ®µ)

#### 2.1.1 è¯­è¨€é€‰æ‹©
- æ”¯æŒè¯­è¨€: æ—¥è¯­ã€è‹±è¯­
- ç”¨æˆ·ç•Œé¢: é¦–é¡µå±•ç¤ºä¸¤ä¸ªè¯­è¨€å¡ç‰‡ä¾›é€‰æ‹©

#### 2.1.2 åœºæ™¯é€‰æ‹©
**10ä¸ªé¢„è®¾åœºæ™¯** (æ¶µç›–æ—¥å¸¸+ä¸“ä¸šåœºæ™¯):

**æ—¥å¸¸ç”Ÿæ´»ç±»:**
1. ğŸœ **é¤å…ç‚¹é¤** - åœ¨é¤å…ä¸æœåŠ¡å‘˜äº¤æµ,ç‚¹é¤ã€è¯¢é—®èœå•
2. ğŸ¨ **é…’åº—å…¥ä½** - åŠç†å…¥ä½æ‰‹ç»­,è¯¢é—®æˆ¿é—´è®¾æ–½
3. ğŸ›’ **è¶…å¸‚è´­ç‰©** - å¯»æ‰¾å•†å“,è¯¢é—®ä»·æ ¼å’Œä¿ƒé”€
4. ğŸš‡ **é—®è·¯äº¤é€š** - è¯¢é—®æ–¹å‘,è´­ä¹°è½¦ç¥¨

**ç¤¾äº¤åœºæ™¯ç±»:**
5. ğŸ‘‹ **è‡ªæˆ‘ä»‹ç»** - ç¬¬ä¸€æ¬¡è§é¢,ä»‹ç»è‡ªå·±çš„èƒŒæ™¯å’Œå…´è¶£
6. â˜• **æ—¥å¸¸é—²èŠ** - ä¸æœ‹å‹èŠå¤©æ°”ã€å‘¨æœ«è®¡åˆ’ç­‰è½»æ¾è¯é¢˜
7. ğŸ“ **ç”µè¯é¢„çº¦** - ç”µè¯é¢„çº¦åŒ»ç”Ÿã€ç†å‘ç­‰æœåŠ¡

**èŒåœº/å­¦æœ¯ç±»:**
8. ğŸ’¼ **å·¥ä½œé¢è¯•** - å›ç­”é¢è¯•å®˜é—®é¢˜,å±•ç¤ºè‡ªå·±çš„èƒ½åŠ›
9. ğŸ“§ **å•†åŠ¡é‚®ä»¶** - è®¨è®ºå¦‚ä½•æ’°å†™æ­£å¼å•†åŠ¡é‚®ä»¶
10. ğŸ“ **è¯¾å ‚è®¨è®º** - åœ¨å­¦æœ¯ç¯å¢ƒä¸­è¡¨è¾¾è§‚ç‚¹å’Œæé—®

#### 2.1.3 å¯¹è¯åŠŸèƒ½
**äº¤äº’æµç¨‹:**
1. ç”¨æˆ·è¾“å…¥æ¶ˆæ¯(æ–‡æœ¬æ¡†)
2. AIå›å¤(æ¨¡æ‹Ÿåœºæ™¯ä¸­çš„å¯¹è¯ä¼™ä¼´)
3. æ”¯æŒå¤šè½®è¿ç»­å¯¹è¯(å»ºè®®10-15è½®)
4. ç”¨æˆ·å¯éšæ—¶ç‚¹å‡»"ç»“æŸå¯¹è¯"æŒ‰é’®

**å¯¹è¯ç•Œé¢è¦ç´ :**
- æ¶ˆæ¯æ°”æ³¡(åŒºåˆ†ç”¨æˆ·/AI)
- æ—¶é—´æˆ³
- å‘é€æŒ‰é’®
- "ç»“æŸå¯¹è¯"æŒ‰é’®(æ˜¾çœ¼ä½ç½®)
- è½®æ¬¡è®¡æ•°å™¨(å¯é€‰,æ˜¾ç¤ºå½“å‰ç¬¬å‡ è½®)

**AIè§’è‰²å®šä½:**
- AIæ‰®æ¼”åœºæ™¯ä¸­çš„å¯¹åº”è§’è‰²(æœåŠ¡å‘˜ã€æœ‹å‹ã€é¢è¯•å®˜ç­‰)
- æ ¹æ®ç”¨æˆ·å›å¤è‡ªç„¶æ¨è¿›å¯¹è¯
- ä¸åœ¨å¯¹è¯ä¸­çº é”™(ä¿æŒæµç•…æ€§)

#### 2.1.4 å¯¹è¯æŠ¥å‘Šç”Ÿæˆ
**è§¦å‘æ—¶æœº:** ç”¨æˆ·ç‚¹å‡»"ç»“æŸå¯¹è¯"å

**æŠ¥å‘Šå†…å®¹æ¨¡å—:**

1. **å¯¹è¯æ¦‚è§ˆ**
   - è¯­è¨€: [æ—¥è¯­/è‹±è¯­]
   - åœºæ™¯: [å…·ä½“åœºæ™¯]
   - å¯¹è¯è½®æ•°: Xè½®
   - æ€»å­—æ•°: Xå­—

2. **è¯­æ³•é”™è¯¯åˆ†æ**
   - åˆ—å‡ºå…·ä½“é”™è¯¯å¥å­
   - æŒ‡å‡ºé”™è¯¯ç±»å‹(æ—¶æ€ã€åŠ©è¯ã€è¯­åºç­‰)
   - æä¾›æ­£ç¡®ç‰ˆæœ¬

3. **è¯æ±‡é—®é¢˜**
   - ä¸å½“ç”¨è¯
   - å»ºè®®ä½¿ç”¨çš„æ›´è‡ªç„¶/å‡†ç¡®çš„è¯æ±‡

4. **è¡¨è¾¾è‡ªç„¶åº¦**
   - æŒ‡å‡ºä¸è‡ªç„¶çš„è¡¨è¾¾æ–¹å¼
   - æä¾›æ¯è¯­è€…å¸¸ç”¨çš„è¯´æ³•

5. **æ­£é¢åé¦ˆä¸å»ºè®®**
   - è¡¨æ‰¬åšå¾—å¥½çš„åœ°æ–¹(ç”¨è¯å‡†ç¡®ã€è¯­æ³•æ­£ç¡®çš„å¥å­)
   - é¼“åŠ±æ€§è¯„è¯­
   - ä¸‹æ¬¡ç»ƒä¹ çš„æ”¹è¿›æ–¹å‘

**æŠ¥å‘Šæ ¼å¼:** ç½‘é¡µå±•ç¤º,æ”¯æŒæ‰“å°/å¤åˆ¶

#### 2.1.5 æœ¬åœ°å­˜å‚¨
- ä½¿ç”¨æµè§ˆå™¨ `localStorage`
- å­˜å‚¨å†…å®¹:
  - å¯¹è¯å†å²(æœ€è¿‘10æ¬¡)
  - æ¯æ¬¡å¯¹è¯çš„å®Œæ•´æŠ¥å‘Š
- å†å²è®°å½•å…¥å£: é¦–é¡µ"æŸ¥çœ‹å†å²"æŒ‰é’®
- è®°å½•åˆ—è¡¨æ˜¾ç¤º: æ—¥æœŸã€è¯­è¨€ã€åœºæ™¯

---

### 2.2 Phase 2: æ•°æ®åº“ç‰ˆæœ¬ (åç»­æ‰©å±•)

#### 2.2.1 åç«¯æ•°æ®æŒä¹…åŒ–
- æ•°æ®åº“: **PostgreSQL** (æ¨è,æ”¯æŒå…è´¹æ‰˜ç®¡)
- å­˜å‚¨å†…å®¹åŒPhase 1,ä½†è¿ç§»åˆ°æœåŠ¡å™¨
- ç”Ÿæˆåˆ†äº«é“¾æ¥åŠŸèƒ½(æ–¹ä¾¿å±•ç¤ºç»™é¢è¯•å®˜)

#### 2.2.2 ç®€å•ç»Ÿè®¡
- æ€»ç»ƒä¹ æ¬¡æ•°
- å„è¯­è¨€ç»ƒä¹ æ¬¡æ•°
- è¿›æ­¥è¶‹åŠ¿å¯è§†åŒ–(å¯é€‰)

---

## 3. æŠ€æœ¯æ¶æ„

### 3.1 æŠ€æœ¯æ ˆ

#### å‰ç«¯
- **æ¡†æ¶**: Vue 3 (Composition API)
- **UIåº“**: Element Plus / Naive UI (æ¨èNaive UI,æ›´ç°ä»£)
- **çŠ¶æ€ç®¡ç†**: Pinia (è½»é‡,é€‚åˆä¸­å°é¡¹ç›®)
- **è·¯ç”±**: Vue Router
- **HTTPå®¢æˆ·ç«¯**: Axios
- **æ ·å¼**: Tailwind CSS (å¯é€‰,å¿«é€Ÿç¾åŒ–)

#### åç«¯
- **è¯­è¨€**: Python 3.10+
- **æ¡†æ¶**: FastAPI (å¼‚æ­¥,æ€§èƒ½å¥½,è‡ªåŠ¨ç”ŸæˆAPIæ–‡æ¡£)
- **AIæ¡†æ¶**: LangChain
- **LLM API**: **æ¨èæ–¹æ¡ˆ:**
  1. **ä¸»åŠ›**: OpenRouter (èšåˆå¤šä¸ªå…è´¹æ¨¡å‹,æœ‰API rate limitä¿æŠ¤)
     - å…è´¹æ¨¡å‹: Google Gemini 2.0 Flash (å…è´¹ä¸”å¼ºå¤§)
     - Meta Llama 3.1 8B (å¼€æºå…è´¹)
  2. **å¤‡é€‰**: Groq (è¶…å¿«æ¨ç†é€Ÿåº¦,æœ‰å…è´¹é¢åº¦)
     - Llama 3.1 ç³»åˆ—å…è´¹

- **æ•°æ®åº“** (Phase 2): PostgreSQL + SQLAlchemy ORM
- **ç¯å¢ƒç®¡ç†**: Poetry / pip + venv

#### éƒ¨ç½²
**Phase 1 (MVP):**
- **å‰ç«¯**: Vercel / Netlify (å…è´¹,è‡ªåŠ¨HTTPS)
- **åç«¯**: Railway / Render å…è´¹å±‚ (æ¯æœˆå…è´¹é¢åº¦)
  - Railway: 500å°æ—¶/æœˆå…è´¹
  - Render: 750å°æ—¶/æœˆå…è´¹
- **æˆæœ¬æ§åˆ¶**:
  - è®¾ç½®APIè°ƒç”¨é¢‘ç‡é™åˆ¶(FastAPIä¸­é—´ä»¶)
  - è®¾ç½®æ¯IPæ¯æ—¥è¯·æ±‚ä¸Šé™
  - LLM APIé€‰æ‹©æœ‰å…è´¹é¢åº¦çš„æœåŠ¡

**Phase 2:**
- æ•°æ®åº“: Railwayå†…ç½®PostgreSQL / Supabaseå…è´¹å±‚

---

### 3.2 ç³»ç»Ÿæ¶æ„å›¾

```
[ç”¨æˆ·æµè§ˆå™¨]
    â†“
[Vueå‰ç«¯ - Vercel]
    â†“ HTTPS APIè°ƒç”¨
[FastAPIåç«¯ - Railway]
    â†“
    â”œâ”€â†’ [LangChain] â†’ [OpenRouter API] â†’ [Gemini/Llama]
    â””â”€â†’ [localStorage] (Phase 1)
         [PostgreSQL] (Phase 2)
```

---

### 3.3 APIè®¾è®¡

#### 3.3.1 å¯¹è¯ç›¸å…³

**POST /api/chat**
```json
// Request
{
  "session_id": "uuid",
  "language": "japanese",
  "scenario": "restaurant",
  "message": "ã™ã¿ã¾ã›ã‚“ã€ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’ãã ã•ã„",
  "history": [
    {"role": "assistant", "content": "..."},
    {"role": "user", "content": "..."}
  ]
}

// Response
{
  "reply": "ã‹ã—ã“ã¾ã‚Šã¾ã—ãŸã€‚ã“ã¡ã‚‰ãŒãƒ¡ãƒ‹ãƒ¥ãƒ¼ã§ã”ã–ã„ã¾ã™ã€‚ãŠæ±ºã¾ã‚Šã«ãªã‚Šã¾ã—ãŸã‚‰ãŠå‘¼ã³ãã ã•ã„ã€‚",
  "session_id": "uuid"
}
```

**POST /api/report/generate**
```json
// Request
{
  "session_id": "uuid",
  "language": "japanese",
  "scenario": "restaurant",
  "conversation": [
    {"role": "user", "content": "..."},
    {"role": "assistant", "content": "..."}
  ]
}

// Response
{
  "report": {
    "overview": {...},
    "grammar_errors": [...],
    "vocabulary_issues": [...],
    "naturalness": [...],
    "positive_feedback": [...]
  }
}
```

#### 3.3.2 å†å²è®°å½• (Phase 2)

**GET /api/history**
```json
// Response
{
  "conversations": [
    {
      "id": "uuid",
      "date": "2025-10-30T10:30:00Z",
      "language": "japanese",
      "scenario": "restaurant",
      "turn_count": 12
    }
  ]
}
```

**GET /api/history/{id}**
```json
// Response
{
  "conversation": [...],
  "report": {...}
}
```

---

## 4. LangChainå®ç°æ–¹æ¡ˆ

### 4.1 å¯¹è¯Agentè®¾è®¡

```python
# ä¼ªä»£ç ç¤ºä¾‹
from langchain.prompts import ChatPromptTemplate
from langchain.schema import SystemMessage, HumanMessage

# å¯¹è¯Promptæ¨¡æ¿
conversation_prompt = ChatPromptTemplate.from_messages([
    ("system", """You are a {role} in a {scenario} scenario.
    The user is practicing {language}.
    Have a natural conversation in {language}.
    Do NOT correct their mistakes during conversation.
    Keep responses concise (2-3 sentences).
    Guide the conversation naturally within the scenario.
    """),
    ("placeholder", "{history}"),
    ("human", "{input}")
])

# æŠ¥å‘Šç”ŸæˆPrompt
report_prompt = """
Analyze the following conversation where a user practiced {language}.
Provide detailed feedback in the following format:

1. Grammar Errors: [list specific mistakes with corrections]
2. Vocabulary Issues: [unnatural word choices with better alternatives]
3. Naturalness: [awkward expressions with native alternatives]
4. Positive Feedback: [praise 2-3 things they did well, give encouragement]

Conversation:
{conversation}
"""
```

### 4.2 Promptç­–ç•¥
- **å¯¹è¯é˜¶æ®µ**: System promptå®šä¹‰AIè§’è‰²å’Œåœºæ™¯è§„åˆ™
- **æŠ¥å‘Šé˜¶æ®µ**: å•ç‹¬çš„åˆ†æprompt,æ˜ç¡®è¾“å‡ºç»“æ„
- **è¯­è¨€ç‰¹å®š**: ä¸ºæ—¥è¯­å’Œè‹±è¯­å‡†å¤‡ä¸åŒçš„åˆ†æç»´åº¦(å¦‚æ—¥è¯­å…³æ³¨åŠ©è¯ã€æ•¬è¯­)

---

## 5. å¼€å‘è®¡åˆ’

### Sprint 1: é¡¹ç›®æ­å»º 
1. åˆå§‹åŒ–å‰ç«¯Vueé¡¹ç›®
2. åˆå§‹åŒ–åç«¯FastAPIé¡¹ç›®
3. é…ç½®CORS,è¿æ¥å‰åç«¯
4. æµ‹è¯•åŸºç¡€APIè°ƒç”¨

### Sprint 2: å¯¹è¯åŠŸèƒ½ 
1. å®ç°åœºæ™¯é€‰æ‹©é¡µé¢
2. å®ç°å¯¹è¯ç•Œé¢UI
3. åç«¯é›†æˆLangChain + OpenRouter
4. å®ç°å¯¹è¯APIç«¯ç‚¹
5. å‰åç«¯å¯¹è¯æµç¨‹è”è°ƒ

### Sprint 3: æŠ¥å‘Šç”Ÿæˆ 
1. è®¾è®¡æŠ¥å‘Šé¡µé¢UI
2. å®ç°æŠ¥å‘Šç”ŸæˆAPI
3. å‰ç«¯å±•ç¤ºæŠ¥å‘Š
4. ä¼˜åŒ–æŠ¥å‘Šprompt

### Sprint 4: æœ¬åœ°å­˜å‚¨ 
1. å‰ç«¯å®ç°localStorageé€»è¾‘
2. å†å²è®°å½•åˆ—è¡¨é¡µé¢
3. æŸ¥çœ‹å†å²å¯¹è¯å’ŒæŠ¥å‘Š

### Sprint 5: éƒ¨ç½²ä¸ä¼˜åŒ– 
1. éƒ¨ç½²å‰ç«¯åˆ°Vercel
2. éƒ¨ç½²åç«¯åˆ°Railway
3. é…ç½®ç¯å¢ƒå˜é‡å’ŒAPIå¯†é’¥
4. æ·»åŠ rate limiting
5. æ€§èƒ½ä¼˜åŒ–å’Œæµ‹è¯•

**æ€»é¢„ä¼°æ—¶é—´: 7-9å¤©**

---

## 6. æˆæœ¬æ§åˆ¶ä¸å®‰å…¨

### 6.1 é˜²æ­¢APIæ»¥ç”¨
```python
# FastAPIä¸­é—´ä»¶ç¤ºä¾‹
from slowapi import Limiter
from slowapi.util import get_remote_address

limiter = Limiter(key_func=get_remote_address)

@app.post("/api/chat")
@limiter.limit("20/hour")  # æ¯IPæ¯å°æ—¶20æ¬¡
async def chat_endpoint():
    ...
```

### 6.2 APIå¯†é’¥ä¿æŠ¤
- åç«¯ç¯å¢ƒå˜é‡å­˜å‚¨API key
- å‰ç«¯ä¸æš´éœ²ä»»ä½•å¯†é’¥
- Railway/Renderæ”¯æŒç¯å¢ƒå˜é‡é…ç½®

### 6.3 å…è´¹é¢åº¦ç›‘æ§
- OpenRouteræä¾›ä½¿ç”¨ä»ªè¡¨æ¿
- è®¾ç½®æ¯æ—¥é¢„ç®—ä¸Šé™($0)
- ä½¿ç”¨å®Œå…¨å…è´¹çš„æ¨¡å‹(Gemini 2.0 Flash)

---

## 7. é¢è¯•å±•ç¤ºè¦ç‚¹

### 7.1 æŠ€æœ¯äº®ç‚¹
- âœ… **å…¨æ ˆèƒ½åŠ›**: Vueå‰ç«¯ + Pythonåç«¯ç‹¬ç«‹å¼€å‘
- âœ… **AIé›†æˆ**: LangChain + LLM APIå®é™…åº”ç”¨
- âœ… **ç°ä»£æŠ€æœ¯æ ˆ**: FastAPIå¼‚æ­¥æ¡†æ¶,Vue 3 Composition API
- âœ… **å·¥ç¨‹åŒ–**: åˆç†çš„æ¶æ„è®¾è®¡,API RESTfulè§„èŒƒ
- âœ… **éƒ¨ç½²ç»éªŒ**: äº‘ç«¯éƒ¨ç½²,ç¯å¢ƒé…ç½®

### 7.2 å¯æ¼”ç¤ºåŠŸèƒ½
1. å®æ—¶å¯¹è¯æµç•…æ€§
2. æŠ¥å‘Šè´¨é‡(å±•ç¤ºçœŸå®çš„é”™è¯¯åˆ†æ)
3. å†å²è®°å½•åŠŸèƒ½
4. å“åº”å¼è®¾è®¡(æ‰‹æœºç«¯é€‚é…)

---

## 8. æœªæ¥æ‰©å±•æ–¹å‘ (Phase 3+)

### 8.1 åŠŸèƒ½æ‰©å±•
- [ ] ç”¨æˆ·è´¦æˆ·ç³»ç»Ÿ
- [ ] è‡ªå®šä¹‰åœºæ™¯
- [ ] éš¾åº¦çº§åˆ«é€‰æ‹©(åˆçº§/ä¸­çº§/é«˜çº§)
- [ ] è¯­éŸ³è¯†åˆ«è¾“å…¥(Web Speech API)
- [ ] è¯­éŸ³åˆæˆè¾“å‡º(TTS)
- [ ] æ¯æ—¥ä¸€ç»ƒæ¨é€
- [ ] å­¦ä¹ è¿›åº¦å¯è§†åŒ–

### 8.2 AIèƒ½åŠ›å¢å¼º
- [ ] æ ¹æ®ç”¨æˆ·æ°´å¹³åŠ¨æ€è°ƒæ•´AIå¯¹è¯éš¾åº¦
- [ ] å¤šæ¨¡æ€æ”¯æŒ(å›¾ç‰‡åœºæ™¯æè¿°)
- [ ] å®æ—¶è¯­æ³•å»ºè®®(å¯¹è¯ä¸­subtleæç¤º)

---

## 9. å‚è€ƒèµ„æº

### 9.1 æ–‡æ¡£
- FastAPI: https://fastapi.tiangolo.com
- LangChain: https://python.langchain.com
- Vue 3: https://vuejs.org
- OpenRouter: https://openrouter.ai/docs

### 9.2 éƒ¨ç½²å¹³å°
- Vercel: https://vercel.com
- Railway: https://railway.app
- Render: https://render.com

---